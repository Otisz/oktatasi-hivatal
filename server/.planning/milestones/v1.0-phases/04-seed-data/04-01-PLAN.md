---
phase: 04-seed-data
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - database/seeders/ProgramSeeder.php
  - database/seeders/ApplicantSeeder.php
  - database/seeders/DatabaseSeeder.php
autonomous: true
requirements:
  - SEED-01
  - SEED-02
  - SEED-03
  - SEED-04
  - SEED-05
  - SEED-06
  - SEED-07

must_haves:
  truths:
    - "php artisan migrate:fresh --seed completes without error"
    - "ELTE IK programme exists with matematika as mandatory and biologia/fizika/informatika/kemia as electives (5 program_subjects rows)"
    - "PPKE BTK Anglisztika programme exists with angol nyelv at emelt level as mandatory and francia/nemet/olasz/orosz/spanyol/tortenelem as electives (7 program_subjects rows)"
    - "Applicant 1 (CASE_1_UUID) has 5 exam results and 2 bonus points matching homework_input.php exactly"
    - "Applicant 2 (CASE_2_UUID) has 6 exam results (same as Applicant 1 plus fizika 98% kozep) and 2 bonus points"
    - "Applicant 3 (CASE_3_UUID) has 3 exam results (matematika, angol, informatika only — no magyar, no tortenelem) and 2 bonus points"
    - "Applicant 4 (CASE_4_UUID) has 5 exam results (magyar at 15%) and 2 bonus points"
    - "DatabaseSeeder calls ProgramSeeder then ApplicantSeeder in FK order, with no WithoutModelEvents trait"
  artifacts:
    - path: "database/seeders/ProgramSeeder.php"
      provides: "Seeds two programmes with their subject requirements"
      contains: "final class ProgramSeeder extends Seeder"
    - path: "database/seeders/ApplicantSeeder.php"
      provides: "Seeds four acceptance-test applicants with exact exam results and bonus points"
      contains: "final class ApplicantSeeder extends Seeder"
    - path: "database/seeders/DatabaseSeeder.php"
      provides: "Orchestrates ProgramSeeder then ApplicantSeeder via $this->call()"
      contains: "ProgramSeeder::class, ApplicantSeeder::class"
  key_links:
    - from: "database/seeders/ApplicantSeeder.php"
      to: "database/seeders/ProgramSeeder.php"
      via: "ProgramSeeder::ELTE_IK_UUID constant used as program_id FK"
      pattern: "ProgramSeeder::ELTE_IK_UUID"
    - from: "database/seeders/ApplicantSeeder.php"
      to: "app/Models/Applicant.php"
      via: "Applicant::CASE_1_UUID through CASE_4_UUID constants for deterministic IDs"
      pattern: "Applicant::CASE_\\d_UUID"
    - from: "database/seeders/ProgramSeeder.php"
      to: "app/Enums/SubjectName.php"
      via: "Enum instances passed directly to Eloquent create() — model casts serialize them"
      pattern: "SubjectName::"
    - from: "database/seeders/DatabaseSeeder.php"
      to: "database/seeders/ProgramSeeder.php"
      via: "$this->call() array ordering ensures FK dependency"
      pattern: "ProgramSeeder::class.*ApplicantSeeder::class"
---

<objective>
Seed two programmes and four acceptance-test applicants with exact exam results and bonus points from homework_input.php, in correct FK order.

Purpose: The seeded data provides the four acceptance test cases that Phase 8 feature tests will verify (Applicant 1: 470pts, Applicant 2: 476pts, Applicant 3: missing global mandatory error, Applicant 4: magyar < 20% error). Without exact seed data, the scoring engine cannot be validated against the homework specification.
Output: ProgramSeeder.php, ApplicantSeeder.php, updated DatabaseSeeder.php — all runnable via `php artisan migrate:fresh --seed`.
</objective>

<execution_context>
@/Users/otisz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/otisz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-seed-data/04-CONTEXT.md
@.planning/phases/04-seed-data/04-RESEARCH.md
@.planning/phases/03-database-schema-and-models/03-02-SUMMARY.md
</context>

<interfaces>
<!-- Models and enums the seeders interact with. Executor needs these to write correct create() calls. -->

From app/Models/Program.php:
```php
final class Program extends Model
{
    use HasFactory, HasUuids;
    // No $fillable — Model::unguard() active
    public function subjects(): HasMany  // -> ProgramSubject
    public function applicants(): HasMany  // -> Applicant
}
```

From app/Models/ProgramSubject.php:
```php
final class ProgramSubject extends Model
{
    use HasFactory, HasUuids;
    // casts: subject_name => SubjectName, requirement_type => RequirementType, required_level => ExamLevel
    public function program(): BelongsTo  // -> Program
}
```

From app/Models/Applicant.php:
```php
final class Applicant extends Model
{
    use HasFactory, HasUuids;
    public const string CASE_1_UUID = '0195a1b2-0000-7000-8000-000000000001';
    public const string CASE_2_UUID = '0195a1b2-0000-7000-8000-000000000002';
    public const string CASE_3_UUID = '0195a1b2-0000-7000-8000-000000000003';
    public const string CASE_4_UUID = '0195a1b2-0000-7000-8000-000000000004';
    public function program(): BelongsTo  // -> Program
    public function examResults(): HasMany  // -> ApplicantExamResult
    public function bonusPoints(): HasMany  // -> ApplicantBonusPoint
}
```

From app/Models/ApplicantExamResult.php:
```php
final class ApplicantExamResult extends Model
{
    use HasFactory, HasUuids;
    // casts: subject_name => SubjectName, level => ExamLevel
    public function applicant(): BelongsTo  // -> Applicant
}
```

From app/Models/ApplicantBonusPoint.php:
```php
final class ApplicantBonusPoint extends Model
{
    use HasFactory, HasUuids;
    // casts: type => LanguageCertificateType (category is NOT cast — plain string)
    public function applicant(): BelongsTo  // -> Applicant
}
```

From app/Enums/SubjectName.php:
```php
enum SubjectName: string
{
    case HungarianLanguageAndLiterature = 'magyar nyelv és irodalom';
    case History = 'történelem';
    case Mathematics = 'matematika';
    case EnglishLanguage = 'angol nyelv';
    case GermanLanguage = 'német nyelv';
    case FrenchLanguage = 'francia nyelv';
    case ItalianLanguage = 'olasz nyelv';
    case RussianLanguage = 'orosz nyelv';
    case SpanishLanguage = 'spanyol nyelv';
    case Informatics = 'informatika';
    case Biology = 'biológia';
    case Physics = 'fizika';
    case Chemistry = 'kémia';
}
```

From app/Enums/ExamLevel.php:
```php
enum ExamLevel: string { case Intermediate = 'közép'; case Advanced = 'emelt'; }
```

From app/Enums/RequirementType.php:
```php
enum RequirementType: string { case Mandatory = 'mandatory'; case Elective = 'elective'; }
```

From app/Enums/LanguageCertificateType.php:
```php
enum LanguageCertificateType: string { case UpperIntermediate = 'B2'; case Advanced = 'C1'; }
```
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgramSeeder and ApplicantSeeder with exact homework data</name>
  <files>database/seeders/ProgramSeeder.php, database/seeders/ApplicantSeeder.php</files>
  <action>
Scaffold both seeders via artisan, then replace their content:
```bash
php artisan make:seeder ProgramSeeder --no-interaction
php artisan make:seeder ApplicantSeeder --no-interaction
```

**ProgramSeeder** (`database/seeders/ProgramSeeder.php`):

Define two UUID constants at the top of the class for cross-referencing from ApplicantSeeder:
```php
public const string ELTE_IK_UUID = '0195a1b2-0000-7000-8000-000000000101';
public const string PPKE_BTK_UUID = '0195a1b2-0000-7000-8000-000000000102';
```

In `run()`, create the two programmes using `Program::create()` with explicit `'id'` to override HasUuids auto-generation. Then create their subject requirements via `$program->subjects()->create()`.

ELTE IK Programtervezo informatikus:
- `university` = `'ELTE'`, `faculty` = `'IK'`, `name` = `'Programtervező informatikus'`
- 1 mandatory subject: `SubjectName::Mathematics`, `RequirementType::Mandatory`, `required_level` = `null`
- 4 elective subjects: `SubjectName::Biology`, `SubjectName::Physics`, `SubjectName::Informatics`, `SubjectName::Chemistry` — all `RequirementType::Elective`, `required_level` = `null`

PPKE BTK Anglisztika:
- `university` = `'PPKE'`, `faculty` = `'BTK'`, `name` = `'Anglisztika'`
- 1 mandatory subject: `SubjectName::EnglishLanguage`, `RequirementType::Mandatory`, `required_level` = `ExamLevel::Advanced`
- 6 elective subjects: `SubjectName::FrenchLanguage`, `SubjectName::GermanLanguage`, `SubjectName::ItalianLanguage`, `SubjectName::RussianLanguage`, `SubjectName::SpanishLanguage`, `SubjectName::History` — all `RequirementType::Elective`, `required_level` = `null`

CRITICAL: Pass enum instances directly (e.g., `SubjectName::Mathematics`), NOT `->value` strings. The model's `casts()` handles serialization.

**ApplicantSeeder** (`database/seeders/ApplicantSeeder.php`):

Reference `ProgramSeeder::ELTE_IK_UUID` for the program_id FK. Reference `Applicant::CASE_1_UUID` through `CASE_4_UUID` for deterministic applicant IDs.

Each applicant block MUST have a PHPDoc comment documenting expected outcome.

**Applicant 1** (CASE_1_UUID — expected 470: 370 base + 100 bonus):
```
Exams:
  HungarianLanguageAndLiterature, Intermediate, 70
  History,                         Intermediate, 80
  Mathematics,                     Advanced,     90
  EnglishLanguage,                 Intermediate, 94
  Informatics,                     Intermediate, 95
Bonus:
  category='Nyelvvizsga', type=LanguageCertificateType::UpperIntermediate, language='angol'
  category='Nyelvvizsga', type=LanguageCertificateType::Advanced,          language='német'
```

**Applicant 2** (CASE_2_UUID — expected 476: 376 base + 100 bonus):
Same as Applicant 1 plus one additional exam:
```
  Physics, Intermediate, 98
```
Same bonus points as Applicant 1.

**Applicant 3** (CASE_3_UUID — expected MissingGlobalMandatorySubjectException):
```
Exams (only 3 — missing magyar and tortenelem):
  Mathematics,    Advanced,     90
  EnglishLanguage, Intermediate, 94
  Informatics,    Intermediate, 95
Bonus:
  category='Nyelvvizsga', type=LanguageCertificateType::UpperIntermediate, language='angol'
  category='Nyelvvizsga', type=LanguageCertificateType::Advanced,          language='német'
```

**Applicant 4** (CASE_4_UUID — expected FailedExamException for magyar 15%):
```
Exams:
  HungarianLanguageAndLiterature, Intermediate, 15   ← below 20% threshold
  History,                         Intermediate, 80
  Mathematics,                     Advanced,     90
  EnglishLanguage,                 Intermediate, 94
  Informatics,                     Intermediate, 95
Bonus:
  category='Nyelvvizsga', type=LanguageCertificateType::UpperIntermediate, language='angol'
  category='Nyelvvizsga', type=LanguageCertificateType::Advanced,          language='német'
```

For bonus points: pass `category` as the plain string `'Nyelvvizsga'` (NOT an enum — the column has no enum cast). Pass `type` as enum instance `LanguageCertificateType::UpperIntermediate` or `LanguageCertificateType::Advanced` (the model casts `type` to `LanguageCertificateType`).

Create child records via relationship methods:
```php
$applicant->examResults()->create([...]);
$applicant->bonusPoints()->create([...]);
```

Use `declare(strict_types=1)`, `final class`, and import all enums and models at the top of each file. After creating both seeders, run:
```bash
vendor/bin/pint --dirty --format agent
```
  </action>
  <verify>
    <automated>vendor/bin/pint --dirty --format agent</automated>
  </verify>
  <done>ProgramSeeder creates ELTE IK with 5 subjects (1 mandatory + 4 elective) and PPKE BTK with 7 subjects (1 mandatory emelt + 6 elective). ApplicantSeeder creates 4 applicants with exact exam results and bonus points matching homework_input.php. Both use enum instances directly, PHPDoc outcome comments per applicant, and named constants for UUIDs. Pint passes.</done>
</task>

<task type="auto">
  <name>Task 2: Update DatabaseSeeder and verify migrate:fresh --seed</name>
  <files>database/seeders/DatabaseSeeder.php</files>
  <action>
Rewrite `database/seeders/DatabaseSeeder.php` to call the two new seeders in FK order. Remove the existing User factory call and the `use WithoutModelEvents` trait (per CONTEXT.md locked decision — models have no observers).

The new DatabaseSeeder:
```php
<?php

declare(strict_types=1);

namespace Database\Seeders;

use Illuminate\Database\Seeder;

final class DatabaseSeeder extends Seeder
{
    public function run(): void
    {
        $this->call([
            ProgramSeeder::class,
            ApplicantSeeder::class,
        ]);
    }
}
```

IMPORTANT: Remove the `use App\Models\User;` import and `use Illuminate\Database\Console\Seeds\WithoutModelEvents;` import. Remove the `use WithoutModelEvents;` trait usage inside the class. The seeder must be clean with only the two `$this->call()` entries.

After updating DatabaseSeeder, run:
```bash
vendor/bin/pint --dirty --format agent
```

Then verify the entire seed pipeline:
```bash
php artisan migrate:fresh --seed --no-interaction
```

This must complete without error. Then verify data integrity by querying the database:

1. Verify programmes: `SELECT count(*) FROM programs` = 2
2. Verify programme subjects: `SELECT count(*) FROM program_subjects` = 12 (5 for ELTE IK + 7 for PPKE BTK)
3. Verify applicants: `SELECT count(*) FROM applicants` = 4
4. Verify exam results: `SELECT count(*) FROM applicant_exam_results` = 19 (5 + 6 + 3 + 5)
5. Verify bonus points: `SELECT count(*) FROM applicant_bonus_points` = 8 (2 per applicant)
6. Verify Applicant 1 has 5 exam results and 2 bonus points
7. Verify Applicant 3 has exactly 3 exam results (no magyar, no tortenelem)
8. Verify Applicant 4 has magyar at 15%

Use the tinker tool or database-query tool for verification. If any count is wrong, fix the seeder and re-run.
  </action>
  <verify>
    <automated>php artisan migrate:fresh --seed --no-interaction</automated>
  </verify>
  <done>DatabaseSeeder calls ProgramSeeder then ApplicantSeeder in FK order. No WithoutModelEvents trait. migrate:fresh --seed completes without error. Database contains 2 programmes (12 subjects total), 4 applicants (19 exam results total, 8 bonus points total). Applicant 3 has exactly 3 exams. Applicant 4 has magyar at 15%. All counts verified.</done>
</task>

</tasks>

<verification>
Run these checks after both tasks complete:

1. `php artisan migrate:fresh --seed --no-interaction` — exits with code 0
2. `SELECT count(*) FROM programs` = 2
3. `SELECT count(*) FROM program_subjects` = 12
4. `SELECT count(*) FROM applicants` = 4
5. `SELECT count(*) FROM applicant_exam_results` = 19
6. `SELECT count(*) FROM applicant_bonus_points` = 8
7. Applicant 1 (CASE_1_UUID): 5 exams, 2 bonus points
8. Applicant 2 (CASE_2_UUID): 6 exams, 2 bonus points
9. Applicant 3 (CASE_3_UUID): 3 exams (no magyar, no tortenelem), 2 bonus points
10. Applicant 4 (CASE_4_UUID): 5 exams (magyar at 15%), 2 bonus points
11. ELTE IK has 5 program_subjects (1 mandatory + 4 elective), no required_level
12. PPKE BTK has 7 program_subjects (1 mandatory with required_level = 'emelt' + 6 elective)
13. `vendor/bin/pint --dirty --format agent` — no changes
</verification>

<success_criteria>
- php artisan migrate:fresh --seed runs without error
- Two programmes seeded with correct subject requirements (12 total subjects)
- Four applicants seeded with deterministic UUIDs matching Applicant::CASE_*_UUID constants
- Exam results and bonus points match homework_input.php exactly (19 exams, 8 bonus points)
- Enum instances used directly in create() calls (not ->value)
- PHPDoc outcome comments on each applicant block
- UUID constants defined on ProgramSeeder for cross-referencing
- DatabaseSeeder has no WithoutModelEvents trait
- Pint passes on all seeder files
</success_criteria>

<output>
After completion, create `.planning/phases/04-seed-data/04-01-SUMMARY.md`
</output>
