---
phase: 07-scoring-service
plan: 02
type: execute
wave: 1
depends_on: ["07-01"]
files_modified: [app/Providers/AppServiceProvider.php, tests/Feature/Services/AdmissionScoringServiceContainerTest.php]
autonomous: true
requirements: [BIZ-05]
gap_closure: true

must_haves:
  truths:
    - "AdmissionScoringService resolves from the Laravel container without errors"
    - "ProgramRegistryInterface resolves to ProgramRegistry singleton"
    - "BasePointCalculatorInterface resolves to BasePointCalculator singleton"
    - "BonusPointCalculatorInterface resolves to BonusPointCalculator singleton"
  artifacts:
    - path: "app/Providers/AppServiceProvider.php"
      provides: "Interface-to-concrete singleton bindings for 3 scoring interfaces"
      contains: "ProgramRegistryInterface"
    - path: "tests/Feature/Services/AdmissionScoringServiceContainerTest.php"
      provides: "Feature test proving container resolution works"
      min_lines: 15
  key_links:
    - from: "app/Providers/AppServiceProvider.php"
      to: "app/Services/ProgramRegistry.php"
      via: "singleton binding ProgramRegistryInterface -> ProgramRegistry"
      pattern: "singleton.*ProgramRegistryInterface.*ProgramRegistry"
    - from: "app/Providers/AppServiceProvider.php"
      to: "app/Services/BasePointCalculator.php"
      via: "singleton binding BasePointCalculatorInterface -> BasePointCalculator"
      pattern: "singleton.*BasePointCalculatorInterface.*BasePointCalculator"
    - from: "app/Providers/AppServiceProvider.php"
      to: "app/Services/BonusPointCalculator.php"
      via: "singleton binding BonusPointCalculatorInterface -> BonusPointCalculator"
      pattern: "singleton.*BonusPointCalculatorInterface.*BonusPointCalculator"
---

<objective>
Close the UAT gap: register interface-to-concrete bindings so AdmissionScoringService resolves from the Laravel container.

Purpose: Phase 07-01 created three interfaces (ProgramRegistryInterface, BasePointCalculatorInterface, BonusPointCalculatorInterface) and refactored AdmissionScoringService to depend on them via constructor injection, but never registered the bindings in any service provider. This causes a BindingResolutionException when the container tries to instantiate the service.

Output: Updated AppServiceProvider with three singleton bindings and a feature test proving container resolution.
</objective>

<execution_context>
@/Users/otisz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/otisz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-scoring-service/07-01-SUMMARY.md

<interfaces>
<!-- Interfaces that need bindings registered in AppServiceProvider -->

From app/Contracts/ProgramRegistryInterface.php:
```php
interface ProgramRegistryInterface
{
    public function findByApplicant(Applicant $applicant): ProgramRequirementsInterface;
}
```

From app/Contracts/BasePointCalculatorInterface.php:
```php
interface BasePointCalculatorInterface
{
    public function calculate(ExamResult $mandatory, ExamResult $bestElective): int;
}
```

From app/Contracts/BonusPointCalculatorInterface.php:
```php
interface BonusPointCalculatorInterface
{
    /** @param array<int, ExamResult> $examResults  @param array<int, LanguageCertificate> $certificates */
    public function calculate(array $examResults, array $certificates): int;
}
```

Concrete implementations:
- `App\Services\ProgramRegistry implements ProgramRegistryInterface`
- `App\Services\BasePointCalculator implements BasePointCalculatorInterface`
- `App\Services\BonusPointCalculator implements BonusPointCalculatorInterface`

Current AppServiceProvider::register() (line 15-19):
```php
public function register(): void
{
    Model::unguard();
    Model::preventLazyLoading();
    Model::preventAccessingMissingAttributes();
}
```
</interfaces>
</context>

<tasks>

<task type="auto" tdd="true">
  <name>Task 1: Add interface-to-concrete singleton bindings in AppServiceProvider</name>
  <files>app/Providers/AppServiceProvider.php, tests/Feature/Services/AdmissionScoringServiceContainerTest.php</files>
  <behavior>
    - Test 1: `app(ProgramRegistryInterface::class)` returns an instance of `ProgramRegistry`
    - Test 2: `app(BasePointCalculatorInterface::class)` returns an instance of `BasePointCalculator`
    - Test 3: `app(BonusPointCalculatorInterface::class)` returns an instance of `BonusPointCalculator`
    - Test 4: `app(AdmissionScoringService::class)` resolves without BindingResolutionException
  </behavior>
  <action>
    1. Create `tests/Feature/Services/AdmissionScoringServiceContainerTest.php` using `php artisan make:test --pest Services/AdmissionScoringServiceContainerTest`. Write 4 Pest tests asserting the behaviors above. Run tests — they MUST fail with BindingResolutionException (RED).

    2. Open `app/Providers/AppServiceProvider.php`. In `register()`, add three singleton bindings AFTER the existing Model configuration calls:

    ```php
    $this->app->singleton(
        \App\Contracts\ProgramRegistryInterface::class,
        \App\Services\ProgramRegistry::class,
    );
    $this->app->singleton(
        \App\Contracts\BasePointCalculatorInterface::class,
        \App\Services\BasePointCalculator::class,
    );
    $this->app->singleton(
        \App\Contracts\BonusPointCalculatorInterface::class,
        \App\Services\BonusPointCalculator::class,
    );
    ```

    Use fully-qualified class names in the binding calls (no `use` imports needed — keeps the provider clean). Use `singleton` (not `bind`) because these services are stateless.

    3. Run tests again — all 4 MUST pass (GREEN).

    4. Run `vendor/bin/pint --dirty --format agent` to fix formatting.

    5. Run `php artisan test --compact` to confirm no regressions across the full suite.
  </action>
  <verify>
    <automated>cd /Users/otisz/Projects/oktatasi-hivatal/server && php artisan test --compact --filter=AdmissionScoringServiceContainerTest</automated>
  </verify>
  <done>All 4 container resolution tests pass. AdmissionScoringService resolves from the container without BindingResolutionException. Full test suite has zero regressions.</done>
</task>

</tasks>

<verification>
1. `php artisan test --compact` — all tests pass (existing 64 + 4 new = 68+)
2. Tinker verification: `app(App\Services\AdmissionScoringService::class)` returns an AdmissionScoringService instance (the original UAT failure case)
3. `vendor/bin/pint --dirty --format agent` — no formatting violations
</verification>

<success_criteria>
- AppServiceProvider::register() contains three singleton bindings mapping interfaces to concrete classes
- `app(AdmissionScoringService::class)` resolves without error in tinker
- 4 new feature tests pass proving container wiring
- Full test suite passes with zero regressions
</success_criteria>

<output>
After completion, create `.planning/phases/07-scoring-service/07-02-SUMMARY.md`
</output>
