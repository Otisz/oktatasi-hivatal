---
phase: 02-value-objects
plan: 02
type: tdd
wave: 1
depends_on: []
files_modified:
  - app/ValueObjects/LanguageCertificate.php
  - app/ValueObjects/Score.php
  - tests/Unit/ValueObjects/LanguageCertificateTest.php
  - tests/Unit/ValueObjects/ScoreTest.php
autonomous: true
requirements:
  - DOM-05
  - DOM-06
  - TEST-02
  - TEST-03

must_haves:
  truths:
    - "LanguageCertificate stores type and language as readonly properties and is immutable"
    - "LanguageCertificate::points() returns 28 for UpperIntermediate and 40 for Advanced (delegated to enum)"
    - "LanguageCertificate::language() returns the language string and matches the $language property"
    - "Score stores basePoints and bonusPoints as readonly non-negative integers"
    - "Score::total() returns basePoints + bonusPoints"
    - "Score throws InvalidArgumentException for negative basePoints or bonusPoints"
    - "Score::basePoints() and Score::bonusPoints() accessor methods return stored values"
    - "LanguageCertificateTest and ScoreTest both pass with full dataset coverage"
  artifacts:
    - path: "app/ValueObjects/LanguageCertificate.php"
      provides: "Immutable Value Object for language certificates, delegates points to enum"
      contains: "readonly class LanguageCertificate"
    - path: "app/ValueObjects/Score.php"
      provides: "Immutable Value Object for admission scores with non-negative validation"
      contains: "readonly class Score"
    - path: "tests/Unit/ValueObjects/LanguageCertificateTest.php"
      provides: "Pest unit tests for LanguageCertificate points delegation and property access"
      contains: "LanguageCertificate"
    - path: "tests/Unit/ValueObjects/ScoreTest.php"
      provides: "Pest unit tests for Score total calculation, getters, and negative validation"
      contains: "Score"
  key_links:
    - from: "app/ValueObjects/LanguageCertificate.php"
      to: "app/Enums/LanguageCertificateType.php"
      via: "use App\\Enums\\LanguageCertificateType for type property and points() delegation"
      pattern: "\\$this->type->points\\(\\)"
    - from: "app/ValueObjects/Score.php"
      to: "Phase 6 calculators"
      via: "Score is constructed by calculators with computed basePoints and bonusPoints"
      pattern: "new Score"
---

<objective>
Create the LanguageCertificate and Score Value Objects with full Pest unit test coverage using TDD.

Purpose: LanguageCertificate encapsulates language exam certifications with point delegation to the enum. Score is the final output container for admission calculation results. Both are simpler than ExamResult (no multi-stage validation) and can share a plan without exceeding context budget.
Output: Two readonly classes in app/ValueObjects/ and two Pest unit test files in tests/Unit/ValueObjects/ with dataset-driven boundary coverage.
</objective>

<execution_context>
@/Users/otisz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/otisz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-value-objects/02-CONTEXT.md
@.planning/phases/02-value-objects/02-RESEARCH.md
</context>

<interfaces>
<!-- Phase 1 enum consumed by LanguageCertificate -->

From app/Enums/LanguageCertificateType.php:
```php
enum LanguageCertificateType: string
{
    case UpperIntermediate = 'B2';
    case Advanced = 'C1';

    public function points(): int
    {
        return match ($this) {
            self::UpperIntermediate => 28,
            self::Advanced => 40,
        };
    }
}
```

<!-- Score has no Phase 1 dependencies — it is a pure data container -->
</interfaces>

<feature>
  <name>LanguageCertificate and Score Value Objects</name>
  <files>app/ValueObjects/LanguageCertificate.php, app/ValueObjects/Score.php, tests/Unit/ValueObjects/LanguageCertificateTest.php, tests/Unit/ValueObjects/ScoreTest.php</files>
  <behavior>
    **LanguageCertificate** — readonly class:
    - Constructor: LanguageCertificateType $type, string $language (both promoted public readonly)
    - No constructor validation (all inputs are valid by type)
    - points(): int → delegates to $this->type->points()
    - language(): string → returns $this->language

    Test cases:
    - points() returns 28 for UpperIntermediate, 40 for Advanced
    - language() returns the language string passed to constructor
    - $language property is directly accessible and matches language()
    - $type property is directly accessible

    **Score** — readonly class:
    - Constructor: int $basePoints, int $bonusPoints (both promoted public readonly)
    - Constructor validation: both must be non-negative, throws InvalidArgumentException if not
    - total(): int → returns $this->basePoints + $this->bonusPoints
    - basePoints(): int → returns $this->basePoints
    - bonusPoints(): int → returns $this->bonusPoints

    Test cases:
    - total() dataset: (0,0)→0, (370,100)→470, (400,100)→500
    - basePoints property and method both return same value
    - bonusPoints property and method both return same value
    - Negative basePoints → InvalidArgumentException
    - Negative bonusPoints → InvalidArgumentException
  </behavior>
  <implementation>
    RED: Create both test files first. Tests fail because classes don't exist.
    GREEN: Create both VO classes. All tests pass.
    REFACTOR: Run Pint and PHPStan on all new files.
  </implementation>
</feature>

<tasks>

<task type="auto">
  <name>Task 1: RED — Write failing LanguageCertificateTest and ScoreTest</name>
  <files>tests/Unit/ValueObjects/LanguageCertificateTest.php, tests/Unit/ValueObjects/ScoreTest.php</files>
  <action>
Create both test files using Artisan:
```bash
php artisan make:test --pest --unit --no-interaction ValueObjects/LanguageCertificateTest
php artisan make:test --pest --unit --no-interaction ValueObjects/ScoreTest
```

**LanguageCertificateTest.php:**

Replace scaffolded content. Use `declare(strict_types=1)` at the top.

Import:
```php
use App\Enums\LanguageCertificateType;
use App\ValueObjects\LanguageCertificate;
```

Test cases:

**1. points() returns correct value per certificate type:**
```php
it('returns correct points per certificate type', function (LanguageCertificateType $type, int $expectedPoints) {
    $cert = new LanguageCertificate($type, 'angol');
    expect($cert->points())->toBe($expectedPoints);
})->with([
    'B2 upper intermediate' => [LanguageCertificateType::UpperIntermediate, 28],
    'C1 advanced'           => [LanguageCertificateType::Advanced, 40],
]);
```

**2. language() method returns language string:**
```php
it('returns the language string via method', function () {
    $cert = new LanguageCertificate(LanguageCertificateType::UpperIntermediate, 'német');
    expect($cert->language())->toBe('német');
});
```

**3. Public properties are accessible:**
```php
it('exposes type and language as public properties', function () {
    $cert = new LanguageCertificate(LanguageCertificateType::Advanced, 'francia');
    expect($cert->type)->toBe(LanguageCertificateType::Advanced)
        ->and($cert->language)->toBe('francia');
});
```

**4. language() matches $language property:**
```php
it('language method returns same value as language property', function (string $lang) {
    $cert = new LanguageCertificate(LanguageCertificateType::UpperIntermediate, $lang);
    expect($cert->language())->toBe($cert->language);
})->with(['angol', 'német', 'francia']);
```

---

**ScoreTest.php:**

Replace scaffolded content. Use `declare(strict_types=1)` at the top.

Import:
```php
use App\ValueObjects\Score;
```

Test cases:

**1. total() calculation with dataset:**
```php
it('calculates total correctly', function (int $base, int $bonus, int $expected) {
    $score = new Score($base, $bonus);
    expect($score->total())->toBe($expected);
})->with([
    'zero base and bonus'    => [0, 0, 0],
    'typical admission'      => [370, 100, 470],
    'max possible'           => [400, 100, 500],
]);
```

**2. basePoints accessible via property and method:**
```php
it('exposes basePoints via property and method', function () {
    $score = new Score(370, 100);
    expect($score->basePoints)->toBe(370)
        ->and($score->basePoints())->toBe(370);
});
```

**3. bonusPoints accessible via property and method:**
```php
it('exposes bonusPoints via property and method', function () {
    $score = new Score(370, 100);
    expect($score->bonusPoints)->toBe(100)
        ->and($score->bonusPoints())->toBe(100);
});
```

**4. Negative basePoints throws InvalidArgumentException:**
```php
it('throws InvalidArgumentException for negative base points', function () {
    expect(fn () => new Score(-1, 0))->toThrow(\InvalidArgumentException::class);
});
```

**5. Negative bonusPoints throws InvalidArgumentException:**
```php
it('throws InvalidArgumentException for negative bonus points', function () {
    expect(fn () => new Score(0, -1))->toThrow(\InvalidArgumentException::class);
});
```

After creating both test files, run them to confirm RED state:
```bash
php artisan test --compact --filter=LanguageCertificateTest
php artisan test --compact --filter=ScoreTest
```

Both test runs MUST fail (classes don't exist yet).
  </action>
  <verify>
    <automated>php artisan test --compact --filter="LanguageCertificateTest|ScoreTest" 2>&1 | grep -E "FAIL|ERROR|Tests:"</automated>
  </verify>
  <done>LanguageCertificateTest.php and ScoreTest.php exist in tests/Unit/ValueObjects/ with full dataset coverage. Both test runs fail because VO classes do not exist yet (RED state confirmed).</done>
</task>

<task type="auto">
  <name>Task 2: GREEN + REFACTOR — Implement LanguageCertificate and Score readonly classes</name>
  <files>app/ValueObjects/LanguageCertificate.php, app/ValueObjects/Score.php</files>
  <action>
The `app/ValueObjects/` directory should already exist from Plan 01. If not, create it.

**LanguageCertificate.php:**

File must have:
- `declare(strict_types=1)`
- `namespace App\ValueObjects;`
- Import: `App\Enums\LanguageCertificateType`

```php
readonly class LanguageCertificate
{
    public function __construct(
        public LanguageCertificateType $type,
        public string $language,
    ) {}

    public function points(): int
    {
        return $this->type->points();
    }

    public function language(): string
    {
        return $this->language;
    }
}
```

No constructor validation needed — LanguageCertificateType is type-safe and language is any string.

**Score.php:**

File must have:
- `declare(strict_types=1)`
- `namespace App\ValueObjects;`
- No imports needed (uses only int primitives and \InvalidArgumentException)

```php
readonly class Score
{
    public function __construct(
        public int $basePoints,
        public int $bonusPoints,
    ) {
        if ($basePoints < 0) {
            throw new \InvalidArgumentException(
                "Base points must be non-negative, got {$basePoints}.",
            );
        }

        if ($bonusPoints < 0) {
            throw new \InvalidArgumentException(
                "Bonus points must be non-negative, got {$bonusPoints}.",
            );
        }
    }

    public function total(): int
    {
        return $this->basePoints + $this->bonusPoints;
    }

    public function basePoints(): int
    {
        return $this->basePoints;
    }

    public function bonusPoints(): int
    {
        return $this->bonusPoints;
    }
}
```

NOTE on Score: Both public properties ($basePoints, $bonusPoints) and methods (basePoints(), bonusPoints()) with the same name coexist. This is valid PHP. If PHPStan flags it, rename the methods to getBasePoints()/getBonusPoints() and update tests accordingly — but try the same-name approach first as per the locked decision.

After creating both files:

1. Run tests to confirm GREEN:
```bash
php artisan test --compact --filter="LanguageCertificateTest|ScoreTest"
```
All tests must pass.

2. Run the FULL VO test suite to make sure Plan 01 tests still pass:
```bash
php artisan test --compact --filter=ValueObjects
```

3. REFACTOR — Run Pint on all modified files:
```bash
vendor/bin/pint --dirty --format agent
```

4. Run PHPStan on all ValueObjects:
```bash
./vendor/bin/phpstan analyse app/ValueObjects/ --no-progress
```

Fix any issues from Pint or PHPStan. If PHPStan flags the property/method name collision in Score, rename methods to getBasePoints()/getBonusPoints() and update the ScoreTest accordingly, then re-run tests.

5. Final full suite confirmation:
```bash
php artisan test --compact
```
  </action>
  <verify>
    <automated>php artisan test --compact --filter=ValueObjects && vendor/bin/pint --dirty --format agent && ./vendor/bin/phpstan analyse app/ValueObjects/ --no-progress</automated>
  </verify>
  <done>LanguageCertificate and Score readonly classes exist in app/ValueObjects/. LanguageCertificate delegates points() to enum and exposes language(). Score validates non-negative inputs, computes total(), and provides accessor methods. All VO tests pass (ExamResult + LanguageCertificate + Score). Pint and PHPStan clean on all ValueObject files.</done>
</task>

</tasks>

<verification>
Run these checks to confirm both VOs and tests are correct:

1. `php artisan test --compact --filter=ValueObjects` — all VO tests pass (ExamResult + LanguageCertificate + Score)
2. `./vendor/bin/phpstan analyse app/ValueObjects/ --no-progress` — zero errors at level 7 on all three VO files
3. `vendor/bin/pint --dirty --format agent` — no formatting changes needed
4. `php artisan test --compact` — full test suite passes (no regressions)
</verification>

<success_criteria>
- app/ValueObjects/LanguageCertificate.php is a readonly class with type and language properties
- LanguageCertificate::points() delegates to $this->type->points() returning 28 or 40
- LanguageCertificate::language() returns the language string
- app/ValueObjects/Score.php is a readonly class with basePoints and bonusPoints
- Score throws InvalidArgumentException for negative basePoints or bonusPoints
- Score::total() returns basePoints + bonusPoints
- Score::basePoints() and Score::bonusPoints() return stored values
- tests/Unit/ValueObjects/LanguageCertificateTest.php passes with B2/C1 point datasets
- tests/Unit/ValueObjects/ScoreTest.php passes with total calculation and negative input datasets
- PHPStan level 7 passes with zero errors on all VO files
- Pint passes with no formatting issues
- Full test suite passes with no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/02-value-objects/02-02-SUMMARY.md`
</output>
