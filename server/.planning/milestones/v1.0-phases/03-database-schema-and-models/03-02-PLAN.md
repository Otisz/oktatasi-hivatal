---
phase: 03-database-schema-and-models
plan: 02
type: execute
wave: 2
depends_on:
  - "03-01"
files_modified:
  - app/Models/Program.php
  - app/Models/ProgramSubject.php
  - app/Models/Applicant.php
  - app/Models/ApplicantExamResult.php
  - app/Models/ApplicantBonusPoint.php
  - database/factories/ProgramFactory.php
  - database/factories/ProgramSubjectFactory.php
  - database/factories/ApplicantFactory.php
  - database/factories/ApplicantExamResultFactory.php
  - database/factories/ApplicantBonusPointFactory.php
autonomous: true
requirements:
  - DB-06
  - DB-07

must_haves:
  truths:
    - "All five models use HasUuids and HasFactory traits"
    - "Program hasMany ProgramSubject (subjects()) and hasMany Applicant (applicants())"
    - "ProgramSubject belongsTo Program and casts subject_name to SubjectName, requirement_type to RequirementType, required_level to ExamLevel"
    - "Applicant belongsTo Program, hasMany ApplicantExamResult (examResults()), hasMany ApplicantBonusPoint (bonusPoints()), and defines CASE_1_UUID through CASE_4_UUID constants"
    - "ApplicantExamResult belongsTo Applicant and casts subject_name to SubjectName, level to ExamLevel"
    - "ApplicantBonusPoint belongsTo Applicant and casts type to LanguageCertificateType"
    - "All factories create valid records that insert into the database without error"
    - "Factories include named states: failingExam(), advancedLevel(), forSubject() on ApplicantExamResultFactory; b2Certificate(), c1Certificate() on ApplicantBonusPointFactory"
    - "No model declares $fillable or $guarded (Model::unguard() is active)"
    - "No model declares $with (all eager loading is explicit)"
  artifacts:
    - path: "app/Models/Program.php"
      provides: "Program Eloquent model with HasUuids and subjects/applicants relationships"
      contains: "final class Program extends Model"
    - path: "app/Models/ProgramSubject.php"
      provides: "ProgramSubject model with enum casts and program relationship"
      contains: "final class ProgramSubject extends Model"
    - path: "app/Models/Applicant.php"
      provides: "Applicant model with UUID constants and three relationships"
      contains: "final class Applicant extends Model"
    - path: "app/Models/ApplicantExamResult.php"
      provides: "ApplicantExamResult model with enum casts and applicant relationship"
      contains: "final class ApplicantExamResult extends Model"
    - path: "app/Models/ApplicantBonusPoint.php"
      provides: "ApplicantBonusPoint model with type cast and applicant relationship"
      contains: "final class ApplicantBonusPoint extends Model"
    - path: "database/factories/ProgramFactory.php"
      provides: "Factory for creating test Program records"
      contains: "final class ProgramFactory extends Factory"
    - path: "database/factories/ProgramSubjectFactory.php"
      provides: "Factory for creating test ProgramSubject records"
      contains: "final class ProgramSubjectFactory extends Factory"
    - path: "database/factories/ApplicantFactory.php"
      provides: "Factory for creating test Applicant records"
      contains: "final class ApplicantFactory extends Factory"
    - path: "database/factories/ApplicantExamResultFactory.php"
      provides: "Factory with failingExam, advancedLevel, forSubject states"
      contains: "final class ApplicantExamResultFactory extends Factory"
    - path: "database/factories/ApplicantBonusPointFactory.php"
      provides: "Factory with b2Certificate, c1Certificate states"
      contains: "final class ApplicantBonusPointFactory extends Factory"
  key_links:
    - from: "app/Models/Applicant.php"
      to: "app/Models/Program.php"
      via: "belongsTo relationship"
      pattern: "belongsTo\\(Program::class\\)"
    - from: "app/Models/Applicant.php"
      to: "app/Models/ApplicantExamResult.php"
      via: "hasMany relationship"
      pattern: "hasMany\\(ApplicantExamResult::class\\)"
    - from: "app/Models/Applicant.php"
      to: "app/Models/ApplicantBonusPoint.php"
      via: "hasMany relationship"
      pattern: "hasMany\\(ApplicantBonusPoint::class\\)"
    - from: "app/Models/ProgramSubject.php"
      to: "app/Enums/SubjectName.php"
      via: "enum cast in casts() method"
      pattern: "'subject_name' => SubjectName::class"
    - from: "app/Models/ApplicantExamResult.php"
      to: "app/Enums/SubjectName.php"
      via: "enum cast in casts() method"
      pattern: "'subject_name' => SubjectName::class"
    - from: "database/factories/ApplicantExamResultFactory.php"
      to: "app/Enums/SubjectName.php"
      via: "uses enum cases in definition and states"
      pattern: "SubjectName::cases\\(\\)"
---

<objective>
Create all five Eloquent models with typed relationships and enum casts, plus all five factories with named states for testing.

Purpose: The models are the ORM layer that Phase 4 seeders, Phase 5 strategy pattern, and Phase 7 scoring service query through. The factories enable isolated testing without seeders in Phase 5+ unit tests.
Output: Five model files in app/Models/ with HasUuids, HasFactory, typed relationships, and enum casts; five factory files in database/factories/ with enum-based defaults and named states.
</objective>

<execution_context>
@/Users/otisz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/otisz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-database-schema-and-models/03-CONTEXT.md
@.planning/phases/03-database-schema-and-models/03-RESEARCH.md
@.planning/phases/03-database-schema-and-models/03-01-SUMMARY.md
</context>

<interfaces>
<!-- Phase 1 enums that models cast to. Executor needs these to write correct casts() methods. -->

From app/Enums/SubjectName.php:
```php
enum SubjectName: string
{
    case HungarianLanguageAndLiterature = 'magyar nyelv és irodalom';
    case History = 'történelem';
    case Mathematics = 'matematika';
    case EnglishLanguage = 'angol nyelv';
    case GermanLanguage = 'német nyelv';
    case FrenchLanguage = 'francia nyelv';
    case ItalianLanguage = 'olasz nyelv';
    case RussianLanguage = 'orosz nyelv';
    case SpanishLanguage = 'spanyol nyelv';
    case Informatics = 'informatika';
    case Biology = 'biológia';
    case Physics = 'fizika';
    case Chemistry = 'kémia';
}
```

From app/Enums/ExamLevel.php:
```php
enum ExamLevel: string
{
    case Intermediate = 'közép';
    case Advanced = 'emelt';
}
```

From app/Enums/LanguageCertificateType.php:
```php
enum LanguageCertificateType: string
{
    case UpperIntermediate = 'B2';
    case Advanced = 'C1';
    // points(): UpperIntermediate => 28, Advanced => 40
}
```

From app/Enums/RequirementType.php (created in Plan 01):
```php
enum RequirementType: string
{
    case Mandatory = 'mandatory';
    case Elective = 'elective';
}
```

<!-- Existing AppServiceProvider confirms: -->
- `Model::unguard()` is called — NO $fillable or $guarded on models
- `Model::preventLazyLoading()` is called — tests must eager-load relationships
- `Model::preventAccessingMissingAttributes()` is called — no typos in attribute access
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Create five Eloquent models with HasUuids, typed relationships, and enum casts</name>
  <files>app/Models/Program.php, app/Models/ProgramSubject.php, app/Models/Applicant.php, app/Models/ApplicantExamResult.php, app/Models/ApplicantBonusPoint.php</files>
  <action>
Create all five models. Use `php artisan make:model ModelName --no-interaction` to scaffold each, then replace their content. All models share these traits:
- `declare(strict_types=1);`
- `final class` (Pint enforces `final_class` rule)
- `use HasFactory, HasUuids;` traits
- `/** @use HasFactory<\Database\Factories\XxxFactory> */` PHPDoc on HasFactory
- NO `$fillable`, `$guarded`, or `$with` properties
- Full return type hints on all relationship methods

**Program model** (`app/Models/Program.php`):
```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\Concerns\HasUuids;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\HasMany;

final class Program extends Model
{
    /** @use HasFactory<\Database\Factories\ProgramFactory> */
    use HasFactory, HasUuids;

    /** @return HasMany<ProgramSubject, $this> */
    public function subjects(): HasMany
    {
        return $this->hasMany(ProgramSubject::class);
    }

    /** @return HasMany<Applicant, $this> */
    public function applicants(): HasMany
    {
        return $this->hasMany(Applicant::class);
    }
}
```

**ProgramSubject model** (`app/Models/ProgramSubject.php`):
```php
<?php

declare(strict_types=1);

namespace App\Models;

use App\Enums\ExamLevel;
use App\Enums\RequirementType;
use App\Enums\SubjectName;
use Illuminate\Database\Eloquent\Concerns\HasUuids;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

final class ProgramSubject extends Model
{
    /** @use HasFactory<\Database\Factories\ProgramSubjectFactory> */
    use HasFactory, HasUuids;

    /** @return array<string, class-string> */
    protected function casts(): array
    {
        return [
            'subject_name' => SubjectName::class,
            'requirement_type' => RequirementType::class,
            'required_level' => ExamLevel::class,
        ];
    }

    /** @return BelongsTo<Program, $this> */
    public function program(): BelongsTo
    {
        return $this->belongsTo(Program::class);
    }
}
```

**Applicant model** (`app/Models/Applicant.php`):
```php
<?php

declare(strict_types=1);

namespace App\Models;

use Illuminate\Database\Eloquent\Concerns\HasUuids;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

final class Applicant extends Model
{
    /** @use HasFactory<\Database\Factories\ApplicantFactory> */
    use HasFactory, HasUuids;

    public const string CASE_1_UUID = '0195a1b2-0000-7000-8000-000000000001';
    public const string CASE_2_UUID = '0195a1b2-0000-7000-8000-000000000002';
    public const string CASE_3_UUID = '0195a1b2-0000-7000-8000-000000000003';
    public const string CASE_4_UUID = '0195a1b2-0000-7000-8000-000000000004';

    /** @return BelongsTo<Program, $this> */
    public function program(): BelongsTo
    {
        return $this->belongsTo(Program::class);
    }

    /** @return HasMany<ApplicantExamResult, $this> */
    public function examResults(): HasMany
    {
        return $this->hasMany(ApplicantExamResult::class);
    }

    /** @return HasMany<ApplicantBonusPoint, $this> */
    public function bonusPoints(): HasMany
    {
        return $this->hasMany(ApplicantBonusPoint::class);
    }
}
```

**ApplicantExamResult model** (`app/Models/ApplicantExamResult.php`):
```php
<?php

declare(strict_types=1);

namespace App\Models;

use App\Enums\ExamLevel;
use App\Enums\SubjectName;
use Illuminate\Database\Eloquent\Concerns\HasUuids;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

final class ApplicantExamResult extends Model
{
    /** @use HasFactory<\Database\Factories\ApplicantExamResultFactory> */
    use HasFactory, HasUuids;

    /** @return array<string, class-string> */
    protected function casts(): array
    {
        return [
            'subject_name' => SubjectName::class,
            'level' => ExamLevel::class,
        ];
    }

    /** @return BelongsTo<Applicant, $this> */
    public function applicant(): BelongsTo
    {
        return $this->belongsTo(Applicant::class);
    }
}
```

**ApplicantBonusPoint model** (`app/Models/ApplicantBonusPoint.php`):
```php
<?php

declare(strict_types=1);

namespace App\Models;

use App\Enums\LanguageCertificateType;
use Illuminate\Database\Eloquent\Concerns\HasUuids;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

final class ApplicantBonusPoint extends Model
{
    /** @use HasFactory<\Database\Factories\ApplicantBonusPointFactory> */
    use HasFactory, HasUuids;

    /** @return array<string, class-string> */
    protected function casts(): array
    {
        return [
            'type' => LanguageCertificateType::class,
        ];
    }

    /** @return BelongsTo<Applicant, $this> */
    public function applicant(): BelongsTo
    {
        return $this->belongsTo(Applicant::class);
    }
}
```

IMPORTANT notes:
- The `casts()` return type must be `array<string, class-string>` for PHPStan level 7 compatibility. If PHPStan complains about this specific annotation, fall back to `array<string, string>` or just `array`.
- `category` on ApplicantBonusPoint is NOT cast to an enum — it stays as a plain string per CONTEXT.md locked decisions.
- `required_level` cast to `ExamLevel::class` handles nullable correctly — Laravel returns `null` when the DB value is `null`, without calling `ExamLevel::from(null)`.
- The `CASE_*_UUID` constants on Applicant use UUIDv7-compatible format strings. The exact values do not matter as long as they are valid UUIDs — Phase 4 seeder will insert records with these IDs, and Phase 8 tests will reference them.

After creating all five models, run:
```bash
vendor/bin/pint --dirty --format agent
./vendor/bin/phpstan analyse app/Models/ --no-progress
```
  </action>
  <verify>
    <automated>vendor/bin/pint --dirty --format agent && ./vendor/bin/phpstan analyse app/Models/ --no-progress</automated>
  </verify>
  <done>All five models exist as final classes with HasUuids + HasFactory traits, typed relationship methods, correct enum casts (SubjectName, ExamLevel, RequirementType, LanguageCertificateType), no $fillable/$guarded/$with, and Applicant has CASE_1_UUID through CASE_4_UUID constants. Pint and PHPStan pass on all model files.</done>
</task>

<task type="auto">
  <name>Task 2: Create five factories with enum-based defaults and named states</name>
  <files>database/factories/ProgramFactory.php, database/factories/ProgramSubjectFactory.php, database/factories/ApplicantFactory.php, database/factories/ApplicantExamResultFactory.php, database/factories/ApplicantBonusPointFactory.php</files>
  <action>
Create all five factories. Use `php artisan make:factory ModelNameFactory --no-interaction` for each (or if they were already scaffolded by `make:model`, just replace their content). All factories share:
- `declare(strict_types=1);`
- `final class` (Pint's `final_class` rule)
- Proper `@extends Factory<\App\Models\Xxx>` PHPDoc

**CRITICAL: Factory `definition()` arrays must store enum `.value` strings, NOT enum objects.** The DB column is a string. Storing `fake()->randomElement(SubjectName::cases())` without `->value` causes "could not be converted to string" errors.

**ProgramFactory** (`database/factories/ProgramFactory.php`):
```php
<?php

declare(strict_types=1);

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends Factory<\App\Models\Program>
 */
final class ProgramFactory extends Factory
{
    /** @return array<string, mixed> */
    public function definition(): array
    {
        return [
            'university' => fake()->company(),
            'faculty' => fake()->word(),
            'name' => fake()->sentence(3),
        ];
    }
}
```

**ProgramSubjectFactory** (`database/factories/ProgramSubjectFactory.php`):
```php
<?php

declare(strict_types=1);

namespace Database\Factories;

use App\Enums\ExamLevel;
use App\Enums\RequirementType;
use App\Enums\SubjectName;
use App\Models\Program;
use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends Factory<\App\Models\ProgramSubject>
 */
final class ProgramSubjectFactory extends Factory
{
    /** @return array<string, mixed> */
    public function definition(): array
    {
        return [
            'program_id' => Program::factory(),
            'subject_name' => fake()->randomElement(SubjectName::cases())->value,
            'requirement_type' => fake()->randomElement(RequirementType::cases())->value,
            'required_level' => null,
        ];
    }

    public function mandatory(): static
    {
        return $this->state(fn (array $attributes): array => [
            'requirement_type' => RequirementType::Mandatory->value,
        ]);
    }

    public function elective(): static
    {
        return $this->state(fn (array $attributes): array => [
            'requirement_type' => RequirementType::Elective->value,
        ]);
    }

    public function requiredAdvancedLevel(): static
    {
        return $this->state(fn (array $attributes): array => [
            'required_level' => ExamLevel::Advanced->value,
        ]);
    }

    public function forSubject(SubjectName $subject): static
    {
        return $this->state(fn (array $attributes): array => [
            'subject_name' => $subject->value,
        ]);
    }
}
```

**ApplicantFactory** (`database/factories/ApplicantFactory.php`):
```php
<?php

declare(strict_types=1);

namespace Database\Factories;

use App\Models\Program;
use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends Factory<\App\Models\Applicant>
 */
final class ApplicantFactory extends Factory
{
    /** @return array<string, mixed> */
    public function definition(): array
    {
        return [
            'program_id' => Program::factory(),
        ];
    }
}
```

**ApplicantExamResultFactory** (`database/factories/ApplicantExamResultFactory.php`):
```php
<?php

declare(strict_types=1);

namespace Database\Factories;

use App\Enums\ExamLevel;
use App\Enums\SubjectName;
use App\Models\Applicant;
use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends Factory<\App\Models\ApplicantExamResult>
 */
final class ApplicantExamResultFactory extends Factory
{
    /** @return array<string, mixed> */
    public function definition(): array
    {
        return [
            'applicant_id' => Applicant::factory(),
            'subject_name' => fake()->randomElement(SubjectName::cases())->value,
            'level' => fake()->randomElement(ExamLevel::cases())->value,
            'percentage' => fake()->numberBetween(20, 100),
        ];
    }

    public function failingExam(): static
    {
        return $this->state(fn (array $attributes): array => [
            'percentage' => fake()->numberBetween(0, 19),
        ]);
    }

    public function advancedLevel(): static
    {
        return $this->state(fn (array $attributes): array => [
            'level' => ExamLevel::Advanced->value,
        ]);
    }

    public function intermediateLevel(): static
    {
        return $this->state(fn (array $attributes): array => [
            'level' => ExamLevel::Intermediate->value,
        ]);
    }

    public function forSubject(SubjectName $subject): static
    {
        return $this->state(fn (array $attributes): array => [
            'subject_name' => $subject->value,
        ]);
    }

    public function withPercentage(int $percentage): static
    {
        return $this->state(fn (array $attributes): array => [
            'percentage' => $percentage,
        ]);
    }
}
```

**ApplicantBonusPointFactory** (`database/factories/ApplicantBonusPointFactory.php`):
```php
<?php

declare(strict_types=1);

namespace Database\Factories;

use App\Enums\LanguageCertificateType;
use App\Models\Applicant;
use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends Factory<\App\Models\ApplicantBonusPoint>
 */
final class ApplicantBonusPointFactory extends Factory
{
    /** @return array<string, mixed> */
    public function definition(): array
    {
        return [
            'applicant_id' => Applicant::factory(),
            'category' => 'Nyelvvizsga',
            'type' => fake()->randomElement(LanguageCertificateType::cases())->value,
            'language' => fake()->randomElement(['angol', 'német', 'francia', 'olasz', 'orosz', 'spanyol']),
        ];
    }

    public function b2Certificate(): static
    {
        return $this->state(fn (array $attributes): array => [
            'type' => LanguageCertificateType::UpperIntermediate->value,
        ]);
    }

    public function c1Certificate(): static
    {
        return $this->state(fn (array $attributes): array => [
            'type' => LanguageCertificateType::Advanced->value,
        ]);
    }

    public function forLanguage(string $language): static
    {
        return $this->state(fn (array $attributes): array => [
            'language' => $language,
        ]);
    }
}
```

IMPORTANT notes:
- State method closures must have `: array` return type for Pint's `void_return` / type hint rules.
- ProgramSubjectFactory has `mandatory()`, `elective()`, `requiredAdvancedLevel()`, and `forSubject()` states — these are useful for Phase 4 seeding and Phase 5 testing.
- ApplicantExamResultFactory has `failingExam()`, `advancedLevel()`, `intermediateLevel()`, `forSubject()`, and `withPercentage()` — these cover all testing scenarios from the acceptance cases.
- ApplicantBonusPointFactory has `b2Certificate()`, `c1Certificate()`, and `forLanguage()` — these map to the two certificate types and language selection.
- No `afterCreating()` callbacks per CONTEXT.md — tests chain `->has()` for relationship creation.
- Default percentage is `numberBetween(20, 100)` to avoid accidentally creating failing exam results (percentage < 20 triggers FailedExamException). The `failingExam()` state explicitly sets 0-19 range.

After creating all five factories, run:
```bash
vendor/bin/pint --dirty --format agent
./vendor/bin/phpstan analyse database/factories/ --no-progress
```

Then verify factories work by creating records in tinker:
```php
\App\Models\Applicant::factory()
    ->has(\App\Models\ApplicantExamResult::factory()->count(3))
    ->has(\App\Models\ApplicantBonusPoint::factory()->count(2))
    ->create();
```
  </action>
  <verify>
    <automated>vendor/bin/pint --dirty --format agent && ./vendor/bin/phpstan analyse app/Models/ database/factories/ --no-progress</automated>
  </verify>
  <done>All five factories exist with enum-based defaults and named states. ProgramFactory creates valid programs. ProgramSubjectFactory has mandatory/elective/requiredAdvancedLevel/forSubject states. ApplicantFactory creates valid applicants with program FK. ApplicantExamResultFactory has failingExam/advancedLevel/intermediateLevel/forSubject/withPercentage states. ApplicantBonusPointFactory has b2Certificate/c1Certificate/forLanguage states. All factories create records that insert without error. Pint and PHPStan pass.</done>
</task>

<task type="auto">
  <name>Task 3: Verify models and factories work together with database</name>
  <files>None (verification only)</files>
  <action>
Run `php artisan migrate:fresh --no-interaction` to ensure a clean database, then verify the full stack works by executing these tinker commands:

1. **Create a Program with subjects:**
```php
$program = \App\Models\Program::factory()
    ->has(\App\Models\ProgramSubject::factory()->mandatory()->forSubject(\App\Enums\SubjectName::Mathematics)->count(1))
    ->has(\App\Models\ProgramSubject::factory()->elective()->forSubject(\App\Enums\SubjectName::Informatics)->count(1))
    ->create();
```

2. **Create an Applicant with exam results and bonus points:**
```php
$applicant = \App\Models\Applicant::factory()
    ->for($program)
    ->has(
        \App\Models\ApplicantExamResult::factory()
            ->advancedLevel()
            ->forSubject(\App\Enums\SubjectName::Mathematics)
            ->withPercentage(90)
    )
    ->has(
        \App\Models\ApplicantBonusPoint::factory()
            ->c1Certificate()
            ->forLanguage('angol')
    )
    ->create();
```

3. **Verify relationships resolve (with eager loading to avoid LazyLoadingViolationException):**
```php
$loaded = \App\Models\Applicant::with(['program.subjects', 'examResults', 'bonusPoints'])->find($applicant->id);
// $loaded->program should be a Program instance
// $loaded->program->subjects should be a collection with 2 ProgramSubject instances
// $loaded->examResults should be a collection with 1 ApplicantExamResult
// $loaded->bonusPoints should be a collection with 1 ApplicantBonusPoint
```

4. **Verify enum casting works:**
```php
$examResult = $loaded->examResults->first();
// $examResult->subject_name should be SubjectName::Mathematics (enum instance, not string)
// $examResult->level should be ExamLevel::Advanced (enum instance, not string)
```

5. **Verify the failingExam factory state:**
```php
$failing = \App\Models\ApplicantExamResult::factory()->failingExam()->make();
// $failing->percentage should be between 0 and 19
```

If any step fails, fix the corresponding model or factory and re-verify. Lazy loading violations mean a relationship was accessed without eager loading — use `->load()` or `->with()`.
  </action>
  <verify>
    <automated>php artisan migrate:fresh --no-interaction && php -r "echo 'DB ready';"</automated>
  </verify>
  <done>Models create records successfully via factories. Relationships resolve correctly with eager loading. Enum casting works (accessing subject_name returns SubjectName enum instance, not raw string). Factory states produce the expected attribute values. No LazyLoadingViolationException when relationships are properly eager-loaded.</done>
</task>

</tasks>

<verification>
Run these checks to confirm models and factories are correct:

1. `./vendor/bin/phpstan analyse app/Models/ database/factories/ --no-progress` — zero errors at level 7
2. `vendor/bin/pint --dirty --format agent` — no formatting issues
3. `php artisan migrate:fresh --no-interaction` — all migrations run clean
4. Tinker: Create an Applicant with exam results and bonus points via factories, then eager-load all relationships and verify enum casting returns enum instances (not raw strings)
5. Tinker: Verify `Applicant::CASE_1_UUID` returns `'0195a1b2-0000-7000-8000-000000000001'`
6. Tinker: Verify factory states (failingExam produces percentage 0-19, advancedLevel produces ExamLevel::Advanced->value, b2Certificate produces LanguageCertificateType::UpperIntermediate->value)
</verification>

<success_criteria>
- All five models are final classes with HasUuids + HasFactory traits
- Program has subjects() and applicants() HasMany relationships
- ProgramSubject has program() BelongsTo and casts subject_name, requirement_type, required_level to enums
- Applicant has program() BelongsTo, examResults() and bonusPoints() HasMany, and CASE_1-4_UUID constants
- ApplicantExamResult has applicant() BelongsTo and casts subject_name, level to enums
- ApplicantBonusPoint has applicant() BelongsTo and casts type to LanguageCertificateType
- No model has $fillable, $guarded, or $with properties
- All relationship methods have full return type hints (BelongsTo, HasMany with generics)
- All five factories create valid records without error
- Named states work correctly: failingExam, advancedLevel, intermediateLevel, forSubject, withPercentage, b2Certificate, c1Certificate, forLanguage, mandatory, elective, requiredAdvancedLevel
- PHPStan level 7 passes on all model and factory files
- Pint passes with no formatting changes
</success_criteria>

<output>
After completion, create `.planning/phases/03-database-schema-and-models/03-02-SUMMARY.md`
</output>
