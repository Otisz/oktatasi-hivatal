---
phase: 01-domain-primitives
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - app/Exceptions/AdmissionException.php
  - app/Exceptions/FailedExamException.php
  - app/Exceptions/MissingGlobalMandatorySubjectException.php
  - app/Exceptions/MissingProgramMandatorySubjectException.php
  - app/Exceptions/ProgramMandatorySubjectLevelException.php
  - app/Exceptions/MissingElectiveSubjectException.php
  - app/Exceptions/UnknownProgramException.php
autonomous: true
requirements:
  - DOM-07

must_haves:
  truths:
    - "AdmissionException is abstract and cannot be instantiated directly"
    - "FailedExamException carries subject (SubjectName) and percentage (int) as readonly properties and produces the exact Hungarian message from homework_input.php Case 4"
    - "MissingGlobalMandatorySubjectException produces the exact Hungarian message from homework_input.php Case 3"
    - "All 6 subclasses are final and extend AdmissionException"
    - "All exception classes compile without errors under PHPStan level 7"
  artifacts:
    - path: "app/Exceptions/AdmissionException.php"
      provides: "Abstract base exception for all admission-related errors"
      contains: "abstract class AdmissionException extends \\Exception"
    - path: "app/Exceptions/FailedExamException.php"
      provides: "Exception for exam results below 20%"
      contains: "final class FailedExamException extends AdmissionException"
    - path: "app/Exceptions/MissingGlobalMandatorySubjectException.php"
      provides: "Exception for missing magyar/tortenelem/matematika"
      contains: "final class MissingGlobalMandatorySubjectException extends AdmissionException"
    - path: "app/Exceptions/MissingProgramMandatorySubjectException.php"
      provides: "Exception for missing programme-specific mandatory subject"
      contains: "final class MissingProgramMandatorySubjectException extends AdmissionException"
    - path: "app/Exceptions/ProgramMandatorySubjectLevelException.php"
      provides: "Exception for wrong exam level on programme mandatory"
      contains: "final class ProgramMandatorySubjectLevelException extends AdmissionException"
    - path: "app/Exceptions/MissingElectiveSubjectException.php"
      provides: "Exception for no matching elective subject"
      contains: "final class MissingElectiveSubjectException extends AdmissionException"
    - path: "app/Exceptions/UnknownProgramException.php"
      provides: "Exception for unrecognized programme"
      contains: "final class UnknownProgramException extends AdmissionException"
  key_links:
    - from: "app/Exceptions/FailedExamException.php"
      to: "app/Enums/SubjectName.php"
      via: "use App\\Enums\\SubjectName in constructor"
      pattern: "use App\\\\Enums\\\\SubjectName"
    - from: "app/Exceptions/ProgramMandatorySubjectLevelException.php"
      to: "app/Enums/SubjectName.php, app/Enums/ExamLevel.php"
      via: "use App\\Enums\\SubjectName and App\\Enums\\ExamLevel in constructor"
      pattern: "use App\\\\Enums\\\\(SubjectName|ExamLevel)"
    - from: "app/Exceptions/MissingProgramMandatorySubjectException.php"
      to: "app/Enums/SubjectName.php"
      via: "use App\\Enums\\SubjectName in constructor"
      pattern: "use App\\\\Enums\\\\SubjectName"
---

<objective>
Create the abstract AdmissionException base class and all six typed subclasses that form the exception hierarchy for admission scoring validation.

Purpose: The scoring service (Phase 7) throws these exceptions during its ordered validation chain. The API layer (Phase 8) maps them to 422 responses. Every exception must carry the right context data and produce the correct Hungarian error message.
Output: Seven PHP exception files in app/Exceptions/ — one abstract base and six final subclasses with rich context properties and dynamic Hungarian messages.
</objective>

<execution_context>
@/Users/otisz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/otisz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-domain-primitives/01-CONTEXT.md
@.planning/phases/01-domain-primitives/01-RESEARCH.md
@.planning/phases/01-domain-primitives/01-01-SUMMARY.md
@homework_input.php
</context>

<interfaces>
<!-- Enums created in Plan 01 — executor uses these in exception constructors -->

From app/Enums/SubjectName.php:
```php
enum SubjectName: string
{
    case HungarianLanguageAndLiterature = 'magyar nyelv és irodalom';
    case History = 'történelem';
    case Mathematics = 'matematika';
    // ... 10 more cases
}
```

From app/Enums/ExamLevel.php:
```php
enum ExamLevel: string
{
    case Intermediate = 'közép';
    case Advanced = 'emelt';
}
```
</interfaces>

<tasks>

<task type="auto">
  <name>Task 1: Create AdmissionException abstract base and the two acceptance-tested exceptions</name>
  <files>app/Exceptions/AdmissionException.php, app/Exceptions/FailedExamException.php, app/Exceptions/MissingGlobalMandatorySubjectException.php</files>
  <action>
**AdmissionException (abstract base):**
Run `php artisan make:exception AdmissionException --no-interaction` to scaffold, then replace content.

The class must be `abstract class AdmissionException extends \Exception` in namespace `App\Exceptions` with `declare(strict_types=1)`. Empty body — no methods, no properties. The `abstract` keyword prevents Pint from adding `final` (abstract classes are exempt from the `final_class` rule).

Do NOT add any render() or report() methods — this is a pure domain exception, not HTTP-aware.

**FailedExamException (tested by Case 4):**
Run `php artisan make:exception FailedExamException --no-interaction` to scaffold, then replace content.

`final class FailedExamException extends AdmissionException` with `declare(strict_types=1)`.

Constructor with promoted readonly properties:
```php
public function __construct(
    public readonly SubjectName $subject,
    public readonly int $percentage,
) {
    parent::__construct(
        "nem lehetséges a pontszámítás a {$subject->value} tárgyból elért 20% alatti eredmény miatt"
    );
}
```

Add `use App\Enums\SubjectName;` import.

The message MUST match exactly: when $subject is SubjectName::HungarianLanguageAndLiterature, the message is `"nem lehetséges a pontszámítás a magyar nyelv és irodalom tárgyból elért 20% alatti eredmény miatt"` — this is verified by homework_input.php Case 4.

**MissingGlobalMandatorySubjectException (tested by Case 3):**
Run `php artisan make:exception MissingGlobalMandatorySubjectException --no-interaction` to scaffold, then replace content.

`final class MissingGlobalMandatorySubjectException extends AdmissionException` with `declare(strict_types=1)`.

Constructor with no parameters and fixed message:
```php
public function __construct()
{
    parent::__construct('nem lehetséges a pontszámítás a kötelező érettségi tárgyak hiánya miatt');
}
```

The message MUST match exactly — this is verified by homework_input.php Case 3.

After creating all three files, run `vendor/bin/pint --dirty --format agent` and `./vendor/bin/phpstan analyse app/Exceptions/AdmissionException.php app/Exceptions/FailedExamException.php app/Exceptions/MissingGlobalMandatorySubjectException.php --no-progress`.
  </action>
  <verify>
    <automated>vendor/bin/pint --dirty --format agent && ./vendor/bin/phpstan analyse app/Exceptions/AdmissionException.php app/Exceptions/FailedExamException.php app/Exceptions/MissingGlobalMandatorySubjectException.php --no-progress</automated>
  </verify>
  <done>AdmissionException.php is abstract and extends \Exception. FailedExamException.php is final, has subject and percentage readonly properties, and produces the exact Case 4 Hungarian message. MissingGlobalMandatorySubjectException.php is final and produces the exact Case 3 Hungarian message. Pint and PHPStan pass.</done>
</task>

<task type="auto">
  <name>Task 2: Create the four remaining exception subclasses</name>
  <files>app/Exceptions/MissingProgramMandatorySubjectException.php, app/Exceptions/ProgramMandatorySubjectLevelException.php, app/Exceptions/MissingElectiveSubjectException.php, app/Exceptions/UnknownProgramException.php</files>
  <action>
Create the four remaining exceptions. These are NOT tested by the four acceptance cases in homework_input.php, so their exact Hungarian messages are within Claude's discretion. Use descriptive messages consistent with the established pattern.

**MissingProgramMandatorySubjectException:**
Run `php artisan make:exception MissingProgramMandatorySubjectException --no-interaction` to scaffold, then replace content.

`final class MissingProgramMandatorySubjectException extends AdmissionException` with `declare(strict_types=1)`.

Constructor with promoted readonly property:
```php
public function __construct(
    public readonly SubjectName $subject,
) {
    parent::__construct(
        "nem lehetséges a pontszámítás a {$subject->value} kötelező tárgy hiánya miatt"
    );
}
```

Add `use App\Enums\SubjectName;` import.

**ProgramMandatorySubjectLevelException:**
Run `php artisan make:exception ProgramMandatorySubjectLevelException --no-interaction` to scaffold, then replace content.

`final class ProgramMandatorySubjectLevelException extends AdmissionException` with `declare(strict_types=1)`.

Constructor with two promoted readonly properties:
```php
public function __construct(
    public readonly SubjectName $subject,
    public readonly ExamLevel $requiredLevel,
) {
    parent::__construct(
        "nem lehetséges a pontszámítás a {$subject->value} tárgyból elvárt {$requiredLevel->value} szint hiánya miatt"
    );
}
```

Add `use App\Enums\SubjectName;` and `use App\Enums\ExamLevel;` imports.

**MissingElectiveSubjectException:**
Run `php artisan make:exception MissingElectiveSubjectException --no-interaction` to scaffold, then replace content.

`final class MissingElectiveSubjectException extends AdmissionException` with `declare(strict_types=1)`.

Constructor with no parameters and fixed message:
```php
public function __construct()
{
    parent::__construct('nem lehetséges a pontszámítás a kötelezően választható tárgy hiánya miatt');
}
```

**UnknownProgramException:**
Run `php artisan make:exception UnknownProgramException --no-interaction` to scaffold, then replace content.

`final class UnknownProgramException extends AdmissionException` with `declare(strict_types=1)`.

Constructor with no parameters and fixed message:
```php
public function __construct()
{
    parent::__construct('nem lehetséges a pontszámítás ismeretlen szak miatt');
}
```

After creating all four files, run `vendor/bin/pint --dirty --format agent` and `./vendor/bin/phpstan analyse app/Exceptions/ --no-progress` on the entire Exceptions directory to verify all seven exception files together.
  </action>
  <verify>
    <automated>vendor/bin/pint --dirty --format agent && ./vendor/bin/phpstan analyse app/Exceptions/ --no-progress</automated>
  </verify>
  <done>All four exception files exist as final classes extending AdmissionException. MissingProgramMandatorySubjectException carries SubjectName. ProgramMandatorySubjectLevelException carries SubjectName and ExamLevel. MissingElectiveSubjectException and UnknownProgramException have no-arg constructors with fixed Hungarian messages. Pint and PHPStan pass on all exception files.</done>
</task>

</tasks>

<verification>
Run these checks to confirm the entire exception hierarchy is correct:

1. `./vendor/bin/phpstan analyse app/Exceptions/ --no-progress` — zero errors at level 7
2. `vendor/bin/pint --test --format agent` — no formatting issues
3. Quick tinker verification:
   - `new App\Exceptions\FailedExamException(App\Enums\SubjectName::HungarianLanguageAndLiterature, 15)` produces message: "nem lehetséges a pontszámítás a magyar nyelv és irodalom tárgyból elért 20% alatti eredmény miatt"
   - `new App\Exceptions\MissingGlobalMandatorySubjectException()` produces message: "nem lehetséges a pontszámítás a kötelező érettségi tárgyak hiánya miatt"
   - `new App\Exceptions\MissingProgramMandatorySubjectException(App\Enums\SubjectName::Mathematics)` produces message containing "matematika"
   - `new App\Exceptions\ProgramMandatorySubjectLevelException(App\Enums\SubjectName::EnglishLanguage, App\Enums\ExamLevel::Advanced)` produces message containing "angol nyelv" and "emelt"
   - All subclasses are `instanceof App\Exceptions\AdmissionException`
   - `new App\Exceptions\AdmissionException()` throws a PHP error (cannot instantiate abstract class)
4. Full phase verification: `./vendor/bin/phpstan analyse app/Enums/ app/Exceptions/ --no-progress` — all 10 files pass
</verification>

<success_criteria>
- AdmissionException.php is abstract, extends \Exception, has no methods or properties
- FailedExamException.php is final, stores SubjectName + int as readonly, produces exact Case 4 message
- MissingGlobalMandatorySubjectException.php is final, no-arg constructor, produces exact Case 3 message
- MissingProgramMandatorySubjectException.php is final, stores SubjectName as readonly
- ProgramMandatorySubjectLevelException.php is final, stores SubjectName + ExamLevel as readonly
- MissingElectiveSubjectException.php is final, no-arg constructor, fixed Hungarian message
- UnknownProgramException.php is final, no-arg constructor, fixed Hungarian message
- All exceptions are pure domain objects (no HTTP status code, no render() method)
- PHPStan level 7 passes with zero errors on app/Exceptions/
- Pint passes with no formatting changes needed
</success_criteria>

<output>
After completion, create `.planning/phases/01-domain-primitives/01-02-SUMMARY.md`
</output>
