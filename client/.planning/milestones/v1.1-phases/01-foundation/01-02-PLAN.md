---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - src/vite-env.d.ts
  - src/types/api.ts
  - src/lib/http.ts
  - src/lib/query.ts
  - src/main.ts
  - .env.development
  - .env.production
  - .env.example
autonomous: true
requirements:
  - INFRA-03
  - INFRA-04
  - INFRA-05
  - DATA-01

must_haves:
  truths:
    - "`import.meta.env.VITE_API_BASE_URL` resolves to the configured API URL in browser code"
    - "All four TypeScript interfaces (Applicant, Program, ScoreResult, ApiError) exist in src/types/api.ts and the project compiles with no type errors"
    - "TanStack Query (VueQueryPlugin) is registered in main.ts before mount"
    - "The Axios instance reads VITE_API_BASE_URL as its base URL"
  artifacts:
    - path: "src/vite-env.d.ts"
      provides: "TypeScript type declaration for VITE_ environment variables"
      contains: "VITE_API_BASE_URL"
    - path: "src/types/api.ts"
      provides: "TypeScript interfaces for all API response shapes"
      exports: ["Applicant", "Program", "ScoreResult", "ApiError", "ApiResponse"]
    - path: "src/lib/http.ts"
      provides: "Axios instance configured with VITE_API_BASE_URL"
      exports: ["http"]
    - path: "src/lib/query.ts"
      provides: "QueryClient instance with default options"
      exports: ["queryClient"]
    - path: "src/main.ts"
      provides: "App bootstrap with VueQueryPlugin registered before mount"
      contains: "VueQueryPlugin"
    - path: ".env.development"
      provides: "Development environment variables"
      contains: "VITE_API_BASE_URL"
  key_links:
    - from: "src/lib/http.ts"
      to: "import.meta.env.VITE_API_BASE_URL"
      via: "Axios baseURL config"
      pattern: "import\\.meta\\.env\\.VITE_API_BASE_URL"
    - from: "src/main.ts"
      to: "src/lib/query.ts"
      via: "QueryClient import and VueQueryPlugin registration"
      pattern: "VueQueryPlugin.*queryClient"
    - from: "src/vite-env.d.ts"
      to: "import.meta.env"
      via: "ImportMetaEnv augmentation"
      pattern: "VITE_API_BASE_URL.*string"
---

<objective>
Configure the API data layer: TypeScript interfaces for all API response shapes, Axios HTTP client reading the environment variable, TanStack Query registered as the caching layer, and environment files for dev/prod.

Purpose: Provide the typed API contracts and data fetching infrastructure that Phase 2 composables will consume. After this plan, the project has everything needed to make typed API calls.
Output: `src/types/api.ts` with 5 interfaces, `src/lib/http.ts` with Axios instance, `src/lib/query.ts` with QueryClient, `src/main.ts` wired with VueQueryPlugin, and `.env.*` files.
</objective>

<execution_context>
@/Users/otisz/.claude/get-shit-done/workflows/execute-plan.md
@/Users/otisz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define TypeScript API interfaces and environment variable types</name>
  <files>src/types/api.ts, src/vite-env.d.ts, .env.development, .env.production, .env.example</files>
  <action>
1. Create `src/types/api.ts` with these exact interfaces:
   ```typescript
   export interface Program {
     university: string
     faculty: string
     name: string
   }

   export interface Applicant {
     id: string
     program: Program
   }

   export interface ScoreResult {
     osszpontszam: number
     alappont: number
     tobbletpont: number
   }

   export interface ApiError {
     error: string
   }

   export interface ApiResponse<T> {
     data: T
   }
   ```

   CRITICAL: The field names `osszpontszam`, `alappont`, `tobbletpont` are Hungarian and must be spelled exactly as shown. These come from the Laravel API Resources on the server. Typos are silent at the TypeScript level — they compile fine but produce `undefined` at runtime.

   The `ApiResponse<T>` generic wrapper matches the server's JSON:API-style `{ data: ... }` envelope used by Laravel API Resources.

2. Update `src/vite-env.d.ts` to declare the `VITE_API_BASE_URL` environment variable type:
   ```typescript
   /// <reference types="vite/client" />

   interface ImportMetaEnv {
     readonly VITE_API_BASE_URL: string
   }

   interface ImportMeta {
     readonly env: ImportMetaEnv
   }
   ```

   CRITICAL: Do NOT add any `import` statements to this file — it breaks the ambient type augmentation. The `/// <reference>` directive is sufficient.

3. Create `.env.development`:
   ```
   VITE_API_BASE_URL=http://localhost:8000
   ```

4. Create `.env.production`:
   ```
   VITE_API_BASE_URL=https://api.oktatasi-hivatal.example.com
   ```

5. Create `.env.example`:
   ```
   # API base URL — must include the VITE_ prefix for Vite to expose it to browser code
   # Restart dev server after changing this value
   VITE_API_BASE_URL=http://localhost:8000
   ```

6. Run `npx vue-tsc --noEmit` (or the project's type-check script) to verify all types compile cleanly with zero errors.
  </action>
  <verify>
    <automated>cd /Users/otisz/Projects/oktatasi-hivatal/client && npx vue-tsc --noEmit 2>&1 | tail -5</automated>
  </verify>
  <done>
    - `src/types/api.ts` exports `Program`, `Applicant`, `ScoreResult`, `ApiError`, `ApiResponse`
    - `src/vite-env.d.ts` declares `VITE_API_BASE_URL` as `string` in `ImportMetaEnv`
    - `.env.development` sets `VITE_API_BASE_URL=http://localhost:8000`
    - `.env.production` and `.env.example` exist with appropriate values
    - `vue-tsc --noEmit` reports zero type errors
    - No `import` statements in `src/vite-env.d.ts`
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Axios HTTP client and TanStack Query with VueQueryPlugin</name>
  <files>src/lib/http.ts, src/lib/query.ts, src/main.ts, package.json</files>
  <action>
1. Install TanStack Query and Axios:
   ```bash
   npm install @tanstack/vue-query axios
   ```

2. Create `src/lib/http.ts` — the single Axios instance all API calls must use:
   ```typescript
   import axios from 'axios'

   export const http = axios.create({
     baseURL: import.meta.env.VITE_API_BASE_URL,
     headers: {
       Accept: 'application/json',
       'Content-Type': 'application/json',
     },
   })
   ```

   This instance reads `VITE_API_BASE_URL` exactly once at module load time. All future API calls import `http` from `@/lib/http` — never `axios` directly.

3. Create `src/lib/query.ts` — the QueryClient with reasonable defaults:
   ```typescript
   import { QueryClient } from '@tanstack/vue-query'

   export const queryClient = new QueryClient({
     defaultOptions: {
       queries: {
         staleTime: 1000 * 60 * 5,
       },
     },
   })
   ```

   The 5-minute staleTime is reasonable for this read-only seeded dataset. Phase 2 composables will import `queryClient` if needed for prefetching.

4. Update `src/main.ts` to register `VueQueryPlugin` with the explicit `queryClient` BEFORE `.mount('#app')`:
   ```typescript
   import { VueQueryPlugin } from '@tanstack/vue-query'
   import { createApp } from 'vue'
   import { queryClient } from '@/lib/query'
   import App from './App.vue'
   import './assets/main.css'

   createApp(App)
     .use(VueQueryPlugin, { queryClient })
     .mount('#app')
   ```

   CRITICAL: `.use(VueQueryPlugin, { queryClient })` MUST come before `.mount('#app')`. Registering after mount causes "No QueryClient found" errors on first render.

5. Run `npx vue-tsc --noEmit` to verify all types still compile cleanly.

6. Run `npm run build` to verify the production build succeeds with the new dependencies.

7. Run `npx biome check .` to verify zero lint/format violations on the new files. If Biome reports violations, fix them with `npx biome check --fix .`.

8. Delete the `.gitkeep` files from `src/lib/` and `src/types/` since they now contain real files.
  </action>
  <verify>
    <automated>cd /Users/otisz/Projects/oktatasi-hivatal/client && npm run build 2>&1 | tail -5 && npx vue-tsc --noEmit 2>&1 | tail -3 && npx biome check . 2>&1 | tail -3</automated>
  </verify>
  <done>
    - `@tanstack/vue-query` and `axios` are in `package.json` dependencies
    - `src/lib/http.ts` exports `http` Axios instance with `baseURL` from `import.meta.env.VITE_API_BASE_URL`
    - `src/lib/query.ts` exports `queryClient` with 5-minute staleTime
    - `src/main.ts` registers `VueQueryPlugin` with `queryClient` before `.mount('#app')`
    - `npm run build` succeeds with zero errors
    - `vue-tsc --noEmit` reports zero type errors
    - `npx biome check .` reports zero violations
  </done>
</task>

</tasks>

<verification>
Run all checks in sequence to verify the complete Phase 1 foundation:

```bash
# 1. TypeScript compiles with no errors
npx vue-tsc --noEmit

# 2. Production build succeeds
npm run build

# 3. Biome reports zero violations
npx biome check .

# 4. Verify key files exist
test -f src/types/api.ts && echo "api.ts exists"
test -f src/lib/http.ts && echo "http.ts exists"
test -f src/lib/query.ts && echo "query.ts exists"
test -f .env.development && echo ".env.development exists"

# 5. Verify VueQueryPlugin is registered before mount in main.ts
grep -n "VueQueryPlugin" src/main.ts
grep -n "mount" src/main.ts
```

All checks must pass. The VueQueryPlugin line number must be lower than the mount line number.
</verification>

<success_criteria>
1. `import.meta.env.VITE_API_BASE_URL` resolves to the configured API URL (verifiable by opening browser devtools console after `npm run dev`)
2. All four TypeScript interfaces (`Applicant`, `Program`, `ScoreResult`, `ApiError`) plus the generic `ApiResponse<T>` exist in `src/types/api.ts`
3. `vue-tsc --noEmit` reports zero type errors across all `.ts` and `.vue` files
4. `VueQueryPlugin` is registered in `main.ts` with the `queryClient` from `src/lib/query.ts` before `.mount('#app')`
5. The Axios instance in `src/lib/http.ts` reads `VITE_API_BASE_URL` as its base URL
6. `npm run build` succeeds and `npx biome check .` reports zero violations
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
